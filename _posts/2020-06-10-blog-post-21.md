---
title: Generalized Formulation of Lagrangian Dynamics
date: 2020-06-10
permalink: /posts/2012/08/blog-post-21/
author_profile: false
tags:
  - Robotics
  - Continuous Control
---

We now describe the generalized formulaiton of Lagrangian dynamics for an  $n$-link open chain planar robot. We select the generalized coordinates $\theta \in \mathbf{R}^{n}$ and the forces $\tau \in \mathbf{R}^{n}$. If $\theta_{i}$ is a revolute joint then $\tau_{i}$ will correspond to a torque whereas if $\theta_{i}$ is primatic then $\tau_{i}$ will correspond to a force.  

__The General Formulation__
======  

We can now write the Lagrangian as-  
<center>$\mathbf{L}(\theta,\theta^{'}) = \mathbf{K}(\theta,\theta^{'}) - \mathbf{P}(\theta)$</center>  
where $\mathbf{K}(\theta,\theta^{'})$ is the kinematic energy and $\mathbf{K}(\theta)$ is the potential energy of the overall system. For rigid body linked robots, the kinetic energy can always be expressed as-  
<center>$\mathbf{K}(\theta,\theta^{'}) = \frac{1}{2}\sum_{i=1}^{n}\sum_{j=1}^{n}m_{ij}(\theta)\theta_{i}^{'}\theta_{j}^{'} = \frac{1}{2}\theta^{'T}M(\theta)\theta^{'}$</center>  
where $m_{ij}$ is the $(i,j)^{th}$ element of the $n \times n$ mass matrix $M(\theta)$. The dynamic equations are analytically obtained by evaluating the right-hand side of-  
<center>$\tau_{i} = \frac{d}{dt}\frac{d\mathbf{L}}{d\theta_{i}^{'}} - \frac{d\mathbf{L}}{d\theta_{i}}$</center>  

Combining this with the kinetic energy can be expressed as-  
<p align="center"><img src="/images/sum1.PNG"></p>  

where $\Gamma_{ijk}(\theta)$, known as the __Christoffel symbols of the first kind__, are defined as followed-  
<p align="center"><img src="/images/sum2.PNG"></p>  

This shows that Christoffel symbols which generate the Coriolis and centripetal terms $c(\theta,\theta^{'})$ are derived from the mass matrix $M(\theta)$. As we have seen previously, the equations can be gathered in the form-  
<center>$\tau = M(\theta)\theta^{''} + c(\theta,\theta^{'}) + g(\theta)$</center>  

where $g(\theta)$ is $\frac{d\mathbf{P}}{d\theta}$. We can now explicitly see that the coriolis terms are quadratic in velocity by using the form-  
<center>$\tau = M(\theta)\theta^{''} + \theta^{'T}\Gamma{\theta}\theta^{'} + g(\theta)$</center>  

where $\Gamma(\theta)$ is an $n \times n \times n$ matrix and the product $\theta^{'T}\Gamma(\theta)\theta^{'}$ should be interpreted as followed-  
<p align="center"><img src="/images/sum3.PNG"></p>  

where $\Gamma_{i}(\theta)$ is an $n \times n$ matrix with $(j,k)$th entry $\Gamma_{ijk}$. It is also common to see that the dynamics is written as-  
<center>$\tau = M(\theta)\theta^{''} + C(\theta,\theta^{'})\theta^{'} + g(\theta)$</center>  

where $C(\theta,\theta^{'}) \in \mathbf{R}^{n \times n}$ is called the __Coriolis Matrix__ with the $(i,j)$th entry  
<center>$c_{ij}(\theta,\theta^{'}) = \sum_{k=1}^{n}\Gamma_{ijk}(\theta)\theta_{k}^{'}$</center>  

__Understanding the Mass Matrix__
======  

The kinetic energy $\mathbf{K}$ is a generalization of the familiar expression $\frac{1}{2}mv^{T}v$ for a point mass. The fact that mass matrix $M(\theta)$ is positive definite, i.e.- $\theta^{'T}M(\theta)\theta^{'} > 0 \forall \theta^{'} \neq 0$ is a generalization of the fact that the mass of a point mass object $m > 0$.  

On the other hand, for a point mass with dynamics expressed in cartesian coordinates as $f = mx^{''}$, the mass is independent of the direction of acceleration and the acceleration $x^{''}$ is always positive to the force. A mass matrix $M(\theta)$ presents the effecctive mass in different directions, and $\theta^{''}$ is not generally a scalar multiple of $\tau$ when $\theta^{'} = 0$. This directional dependence can be visualized by mapping a unit ball of joint accelerations ${\theta^{''}|\theta^{''T}\theta^{''}=1}$ through the mass matrix $M(\theta)$ to generate a joint force-torque ellipsoid when the mechanism is at rest. The figure presents the example in the case of a 2R planar open chain robot.  

<p align="center"><img src="/images/ex1.PNG"></p>  

Here, $L_{1} = L_{2} = m_{1} = m_{2} = 1$ at two different joint configurations $(\theta_{1},\theta_{2})=(0,90^{o})$ and $(\theta_{1},\theta_{2})=(0,150^{o})$. The torque ellipsoid can be interpreted as a direction-dependent mass ellipsoid: the same joint acceleration magnitude $||\theta^{''}||$ requires different joint torque magnitudes $||\tau||$ depending on the acceleration direction. The dreictions of the principle axes of the mass ellipsoid are given by the eigenvectors $v_{i}$ of $M(\theta)$ and the lenghts of principal axes are given by its eigenvalues $\lambda_{i}$.  

It is easier to visualize the mass matrix when it is represented as effective mass of the end-effector, since it is possible to feel the mass at the tip of the effector. Let us denote the effective mass matrix at end-effector as $\Lambda(\theta)$ and the velocity of the end-effector as $V = (x^{'},y^{'})$. We know that the kinetic energy of the robot remains the same-  
<center>$\frac{1}{2}\theta^{'}M(\theta)\theta^{'} = \frac{1}{2}V^{T}\Lambda(\theta)V$</center>  

Assuming the Jacobian $J(\theta)$ satisfying $V = J(\theta)\theta^{'}$ is invertible, the above expression can be written as followed-  
<center>$V^{T}\Lambda V = (J^{-1}V)^{T}M(J^{-1}V)$</center>  
<center> = V^{T}(J^{-T}MJ^{-1})V</center>  

In other words, the end-effector mass matrix is  
<center>$\Lambda(\theta) = J^{-T}(\theta)M(\theta)J^{-1}(\theta)$</center>  
<p align="center"><img src="/images/ex2.PNG"></p>  

The figure shows the end-effector mass ellipsoids, wih principal mass directions given by eigenvectors $\Lambda(\theta)$ and principal semi-axis lengths given by its eigenvalues, for the same two 2R robot configurations as in the previous figure.  


