---
title: Task Space and Constrained Dynamics
date: 2020-06-11
permalink: /posts/2012/08/blog-post-22/
author_profile: false
tags:
  - Robotics
  - Continuous Control
---

So far we have looked at dynamics of open chain robots under simple conditions. However, practical scenarios and surroundings of a robot may include obstacles or regions to which the robot is constrained. For these purposes, we look at constrained and task-space dynamics. We formulate the behavior of a robot under a set of constraints using mathematical formulations discussed previously. However, we only consider simpler constraints such as constraints on forces/torques, loop closure constraints, etc.  

__Task-Space Dynamics__
======  

We now consider the change in dynamic equations in end-effector's frame (task-space frame). Let us consider a 6 dof open-chain planar robot governed by the following dynamic equation-  
<center>$\tau = M(\theta)\theta^{''} + h(\theta,\theta^{'})$</center>  
where $\theta \in \mathbf{R}^{n}$ and $\tau \in \mathbf{R}^{6}$. We also ignore for the time-being any end-effector forces $\mathbf{F}_{tip}$. The twist $\mathbf{V} = (w,v)$ of the end-effector is related to the joint vector $\theta^{'}$ by  
<center>$\mathbf{V} = J(\theta)\theta^{'}$</center>  

with the understanding that $\mathbf{V}$ and $J(\theta)$ are always expressed in terms of the same reference frame. The time derivative $\mathbf{V}^{'}$ is then  
<center>$\mathbf{V}^{'} = J^{'}(\theta)\theta^{'} + J(\theta)\theta^{''}$</center>  

At configurations $\theta$ where $J(\theta)$ is invertible, we have  
<center>$\theta^{'} = J^{-1}\mathbf{V}$</center>  
<center>$\theta^{''} = J^{-1}\mathbf{V}^{'} - J^{-1}J^{'}J^{-1}\mathbf{V}$</center>  
Substituting for $\theta^{'}$ and $\theta^{''}$ leads to  
<center>$\tau = M(\theta)(J^{-1}\mathbf{V}^{'} - J^{-1}J^{'}J^{-1}\mathbf{V}) + h(\theta,J^{-1}\mathbf{V})$</center>  

Let $J^{-T}$ denote $(J^{-1})^{T} = (J^{T})^{-1}$. Pre-multiplying both sides by $J^{-T}$ to get  
<center>$J^{-T}\tau = J^{-T}MJ^{-1}\mathbf{V}^{'} - J^{-T}MJ^{-1}J^{'}J^{-1}\mathbf{V} + J^{-T}h(\theta,J^{-1}\mathbf{V})$</center>  
Expressing $J^{-1}\tau$ as the wrench $\mathbf{F}$, the above can be written as  
<center>$\mathbf{F} = \Lambda(\theta)\mathbf{V}^{'} + \eta(\theta,\mathbf{V})$</center>  
where  
<center>$\Lambda(\theta) = J^{-T}MJ^{-1}$</center>  
<center>$\eta{\theta,\mathbf{V}} = - J^{-T}MJ^{-1}J^{'}J^{-1}\mathbf{V} + J^{-T}h(\theta,J^{-1}\mathbf{V})$</center>  

These are the dynamic equations expressed in end-effector coordinates.  

__Constrained Dynamics__
======  

Now consider the case of $n$-joint robot which is subject to $k$ holonomic or non-holonomic Pfaffian constraints of the form  
<center>$A(\theta)\theta^{'} = 0$</center>  
where $A(\theta) \in \mathbf{R}^(k \times n)$. Such constraints can come from loop closure constraints, for example, the motion of an end-effector rigidly holding a door is subject to $k=5$ constraints due to the hinge at the door. As another example, a robot writing with a pen is subject to a single constraint which is to keep the height of the pen at the surface of the paper. In any case, we assume that the constraints do not work on the robot, i.e.- the generalized forces $\tau_{con}$ due to the constraints satisfy  
<center>$\tau_{con}^{T}\theta^{'} = 0$</center>  
This assumption means that $\tau_{con}$ must be a linear combination of the columns of $A^{T}(\theta)$, i.e., $\tau_{con} = A^{T}(\theta)\lambda$ for some $\lambda \in \mathbf{R}^{k}$, since these are generalized forces tht do not work when $\theta^{'}$ is subject to the constraints:  
<center>$(A^{T}(\theta)\lambda)^{T}\theta^{'} = \lambda^{T}A(\theta)\theta^{'} = 0$</center>  
for all $\lambda \in \mathbf{R}^{k}$. For the robot writing example, the assumption of the constraint being workless means that there is no friction betweent the pen and the paper.  

Adding the constraint forces $A^{T}(\theta)\lambda$ to the equations of motion, we can write the $n+k$ constrained equations as  
<center>$\tau = M(\theta)\theta^{''} + h(\theta,\theta^{'}) + A^{T}(\theta)\lambda$</center>  
<center>$A(\theta)\theta^{'} = 0$</center>  
where $\lambda$ is a set of Lagrange mulipliers and $A^{T}(\theta)$ are the forces applied against the constraints and are expressed as joint forces or torques.  

Since the constraints $A(\theta)\theta^{'} = 0$ are satisfied at all times, the time rate of change of constraints staisfies  
<center>$A^{'}(\theta)\theta^{'} + A(\theta)\theta^{''} = 0$</center>  
Assuming that $M(\theta)$ and $A(\theta)$ are full-rank, we can solve for $\theta^{''}$,  
<center>$\theta^{''} = M^{-1}(\theta)(\tau - h(\theta,\theta^{'}) - A^{T}(\theta)\lambda)$</center>  
substituting this in the previous equation and omitting the dependencies  
<center>$A^{'}\theta^{'} + AM^{-1}(\tau - h - A^{T}\lambda) = 0$</center>  
After some manipulation we can solve for the Lagrange multipliers  
<center>$\lambda = (AM^{-1}A^{T})^{-1}(AM^{-1}(\tau - h) + A^{'}\theta^{'})$</center>  
The constrained force depends on both $\tau$ and thet state.  




